# VibrantFrogMCP Usage Guide

## Overview

VibrantFrogMCP provides AI-powered search for your Apple Photos Library through Claude Desktop or any MCP-compatible client.

## Available Tools

### 1. `search_photos` - Find Photos by Description

Search your photo library using natural language queries.

**Parameters:**
- `query` (string, required): Natural language search query
- `n_results` (integer, optional): Number of results to return (default: 5)

**Example Queries:**
- "landscape photos from Rhode Island"
- "photos with dogs"
- "sunset pictures"
- "family gatherings"
- "beach scenes with blue water"
- "portrait photos taken in 2023"

**Returns:**
A list of matching photos with:
- UUID (use this with `get_photo`)
- Filename
- Path (if local)
- Description
- Relevance score

**Example Output:**
```
Found 3 photos:

1. IMG_8948.HEIC
   UUID: 68744A05-F6D2-422B-871D-42C2121731A6
   Path: None
   Description: The image is a photograph of two individuals seated...
   Relevance: 0.87

2. IMG_1234.JPG
   UUID: ABC123-DEF456-...
   Path: /Users/.../IMG_1234.JPG
   Description: A beautiful landscape showing rolling hills...
   Relevance: 0.82

To view a photo, use the get_photo tool with the UUID.
```

### 2. `get_photo` - Retrieve and Display a Photo

Retrieve a specific photo by its UUID (from search results).

**Parameters:**
- `uuid` (string, required): The photo UUID from search results

**What It Does:**
1. Looks up the photo in Apple Photos Library
2. If photo is local: reads it directly
3. If photo is in iCloud: exports it temporarily
4. Encodes the image as base64
5. Returns the image for display
6. **Automatically cleans up** any temporary exports

**Returns:**
- The actual image (displayed inline in Claude Desktop)
- Photo metadata (filename, dimensions)
- Whether it was exported from iCloud

**Example Usage in Claude Desktop:**

```
User: "Find me landscape photos from Rhode Island"
Assistant: [Uses search_photos tool]
         Found 10 photos matching your query...

User: "Show me the first one"
Assistant: [Uses get_photo with UUID from first result]
         [Image displays inline]
         Photo: IMG_8948.HEIC
         Size: 3024x4032
         (Exported from iCloud and cleaned up)
```

### 3. `index_photo` - Index a Single Photo

Index a photo from the filesystem (not typically used by end users).

**Parameters:**
- `image_path` (string, required): Absolute path to image file

### 4. `index_directory` - Index a Directory

Index all photos in a directory recursively (not typically used by end users).

**Parameters:**
- `directory_path` (string, required): Path to directory

## Typical Workflow

### Scenario 1: Finding and Viewing a Specific Photo

**Step 1:** Search for photos
```
User: "Find me photos of sunsets"
```

**Step 2:** Review results and select one
```
Assistant: Found 8 photos...
           1. IMG_5432.JPG (UUID: ABC123...)
           2. IMG_6789.JPG (UUID: DEF456...)
           ...
```

**Step 3:** View the selected photo
```
User: "Show me number 2"
Assistant: [Retrieves and displays IMG_6789.JPG]
```

### Scenario 2: Browsing Multiple Photos

```
User: "Find landscape photos from last summer"
Assistant: [Shows 10 results with UUIDs]

User: "Show me the first 3"
Assistant: [Retrieves and displays photos 1, 2, and 3]
```

### Scenario 3: Refining Search

```
User: "Find portrait photos"
Assistant: [Shows results]

User: "Only show the ones from Rhode Island"
Assistant: [New search with refined query]
```

## Behind the Scenes

### For Local Photos:
1. UUID â†’ Direct file path
2. Read file â†’ Encode â†’ Display
3. Fast (< 1 second)

### For iCloud Photos:
1. UUID â†’ Export to temp directory (may take several seconds)
2. Read file â†’ Encode â†’ Display
3. Delete temp file automatically
4. Slower but fully automatic

### Disk Space Management:
- âœ… Temp exports are **always cleaned up** after display
- âœ… No disk space accumulation
- âœ… Safe to view hundreds of photos

## Technical Details

### Image Encoding
- Photos are returned as base64-encoded data
- Supports: JPEG, PNG, HEIC, HEIF, GIF, WebP
- Works seamlessly with Claude Desktop's image display

### Search Quality
- Powered by semantic search (ChromaDB)
- Uses sentence embeddings (all-MiniLM-L6-v2)
- Descriptions generated by LLaVA 13B vision model
- Includes: composition, colors, mood, quality, orientation

### Performance
- **Search**: Very fast (< 1 second)
- **Retrieve local photo**: Fast (< 1 second)
- **Retrieve iCloud photo**: Slower (depends on network, file size)

## Configuration

### Claude Desktop Integration

Add to your `claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "vibrant-frog": {
      "command": "python",
      "args": ["/path/to/VibrantFrogMCP/vibrant_frog_mcp.py"]
    }
  }
}
```

Restart Claude Desktop to load the MCP server.

## Troubleshooting

### "Photo not found in Apple Photos Library"
- The UUID doesn't exist in your library
- The photo may have been deleted since indexing
- Solution: Re-run the indexing script

### "Could not access photo"
- iCloud photo not downloaded and export failed
- Check internet connection
- Ensure you're signed into iCloud

### "No photos found matching your query"
- Try broader search terms
- Ensure photos are indexed (run `index_photos.py`)
- Check that ChromaDB is accessible

### Search returns wrong photos
- Descriptions may need improvement
- Consider reindexing with updated LLaVA prompt
- Try more specific search terms

## Privacy & Security

- ðŸ”’ All data stays local (on your Mac)
- ðŸ”’ No cloud services involved (except Apple's iCloud for your photos)
- ðŸ”’ MCP server runs locally, not over network
- ðŸ”’ Temporary exports are deleted immediately after use

## Limitations

- Only searches photos that have been indexed
- Indexing is slow (~10 minutes per photo with llava:13b)
- iCloud photos require internet to retrieve
- Search quality depends on LLaVA's description accuracy

## Tips for Best Results

### Writing Good Queries
- âœ… "landscape photos with mountains and blue sky"
- âœ… "portrait photos of children"
- âœ… "beach scenes at sunset"
- âŒ "IMG_1234" (use filename search in Finder instead)
- âŒ "photos from June" (use date search in Apple Photos instead)

### When to Reindex
- After adding many new photos
- After changing LLaVA prompt for better descriptions
- If search results seem outdated

### Managing Large Libraries
- Index in batches using the `limit` parameter
- Use `--local-only` flag to skip iCloud photos initially
- Monitor disk space during indexing (temp exports)
